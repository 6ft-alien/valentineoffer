const products = {
    polaroids: {
        title: "CUSTOMIZED POLAROIDS",
        price: 'Just at ₹7/-',
        description: "*Customizable to any pic\n\n• 350 GSM\n• ANTI-FADE\n• GLOSSY FINISH\n• SPLASH PROOF\n\nYour fav moments, memorized forever.\n\n<a href='https://www.instagram.com/stories/highlights/18073171693451044/' target='_blank' class='review-btn'><svg viewBox='0 0 24 24' width='20' height='20' style='margin-right:8px'><path fill='currentColor' d='M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z'/></svg>View Reviews on Instagram</a>",
        images: [
            "assets/gallery/1717944787940.jpg",
            "assets/gallery/IMG_20240610_130839.jpg"
        ]
    },
    cupidreels: {
        title: "CUPID REELS",
        price: 'Just at ₹19/-',
        description: "*Customizable to any pic\n\n3-4 pictures of yours in a reel format!\n\n• 350 GSM\n• ANTI-FADE\n• GLOSSY FINISH\n• SPLASH PROOF\n\nClassic photo strips for your best memories. Perfect Valentine's gift!\n\n<a href='https://www.instagram.com/stories/highlights/18073171693451044/' target='_blank' class='review-btn'><svg viewBox='0 0 24 24' width='20' height='20' style='margin-right:8px'><path fill='currentColor' d='M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z'/></svg>View Reviews on Instagram</a>",
        images: [
            "assets/cupidreel.jpg",
            "assets/cupidreel.jpg"
        ]
    }
};

// Gallery Images - Listed as in folder
const galleryImages = [
    "1717944224061.jpg",
    "1717944529548.jpg",
    "1717944787940.jpg",
    "1717945289907.jpg",
    "1717945500590.jpg",
    "IMG_20240609_170009.jpg",
    "IMG_20240609_170038.jpg",
    "IMG_20240609_170126.jpg",
    "IMG_20240609_170225.jpg",
    "IMG_20240609_170444.jpg",
    "IMG_20240609_170519.jpg",
    "IMG_20240609_170855.jpg",
    "IMG_20240609_170942.jpg",
    "IMG_20240609_171005.jpg",
    "IMG_20240609_171013_1.jpg",
    "IMG_20240609_172115.jpg",
    "IMG_20240610_130839.jpg",
    "IMG_20240610_133643.jpg",
    "IMG_20240610_133830.jpg",
    "IMG_20240610_133903.jpg"
];

// Gallery Lightbox State
let currentGalleryImages = [];
let currentImageIndex = 0;

function showProduct(productId) {
    const product = products[productId];
    document.querySelector('.hero').classList.add('hidden');

    const productDetails = document.getElementById('product-details');
    productDetails.classList.remove('hidden');

    document.getElementById('product-title').textContent = product.title;

    // Populate product images from product data
    const productImagesContainer = document.getElementById('product-images');
    productImagesContainer.innerHTML = '';

    // Use specific images defined in product object
    const sampleImagePaths = product.images;

    sampleImagePaths.forEach((imgSrc, index) => {
        const img = document.createElement('img');
        img.src = imgSrc;
        img.alt = product.title;
        img.loading = 'lazy';

        // Prevent right-click and long-press
        img.addEventListener('contextmenu', (e) => e.preventDefault());

        // Add click handler to open modal with navigation
        img.addEventListener('click', function () {
            openImageModal(img.src, this, sampleImagePaths, index);
        });
        productImagesContainer.appendChild(img);
    });

    document.getElementById('product-price').innerHTML = `<h2>${product.price}</h2>`;
    document.getElementById('product-description').innerHTML = product.description.replace(/\n/g, '<br>');

    // Update WhatsApp link
    const whatsappBtn = document.querySelector('.whatsapp');
    whatsappBtn.href = "https://api.whatsapp.com/send?phone=919036438620&text=Hey%20SNAP!%20I%20want%20to%20order%20" +
        encodeURIComponent(product.title) + "%20from%20Valentine%20Sale";

    // Scroll to top
    window.scrollTo(0, 0);
}

function showHome() {
    document.querySelector('.hero').classList.remove('hidden');
    document.getElementById('product-details').classList.add('hidden');

    // Scroll to top
    window.scrollTo(0, 0);
}

function openImageModal(imageSrc, clickedElement, imageArray, index) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');

    // Set image array and current index
    currentGalleryImages = imageArray || [imageSrc];
    currentImageIndex = index !== undefined ? index : 0;

    // Set image source
    modalImg.src = currentGalleryImages[currentImageIndex];

    // Update navigation buttons
    updateNavigationButtons();

    // Show modal
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function navigateModal(direction) {
    const newIndex = currentImageIndex + direction;

    if (newIndex >= 0 && newIndex < currentGalleryImages.length) {
        currentImageIndex = newIndex;
        const modalImg = document.getElementById('modalImage');
        modalImg.src = currentGalleryImages[currentImageIndex];
        updateNavigationButtons();
    }
}

function updateNavigationButtons() {
    const prevBtn = document.getElementById('modalPrev');
    const nextBtn = document.getElementById('modalNext');

    if (prevBtn && nextBtn) {
        // Disable prev on first image
        prevBtn.disabled = currentImageIndex === 0;

        // Disable next on last image
        nextBtn.disabled = currentImageIndex === currentGalleryImages.length - 1;
    }
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.classList.remove('active');
    document.body.style.overflow = '';
    currentGalleryImages = [];
    currentImageIndex = 0;
}

function populateGallery() {
    const container = document.getElementById('gallery-container');
    const allGalleryPaths = galleryImages.map(img => `assets/gallery/${img}`);

    galleryImages.forEach((imgSrc, index) => {
        const item = document.createElement('div');
        item.className = 'polaroid-item';

        const photo = document.createElement('div');
        photo.className = 'photo-container';

        const img = document.createElement('img');
        img.src = `assets/gallery/${imgSrc}`;
        img.alt = 'Gallery image';
        img.loading = 'lazy';
        img.style.cursor = 'pointer';

        // Prevent right-click
        img.addEventListener('contextmenu', (e) => e.preventDefault());

        // Click to open lightbox with navigation
        img.addEventListener('click', function () {
            openImageModal(img.src, this, allGalleryPaths, index);
        });

        photo.appendChild(img);
        item.appendChild(photo);
        container.appendChild(item);
    });
}

// Create Valentine background elements (Floating Hearts)
function createValentineBackground() {
    const bg = document.querySelector('.diwali-bg');
    if (!bg) return;

    bg.innerHTML = '';

    const colors = ['#FFEBEE', '#FFCDD2', '#EF9A9A'];

    setInterval(() => {
        const heart = document.createElement('div');
        heart.innerHTML = '❤';
        heart.style.position = 'absolute';
        heart.style.left = Math.random() * 100 + '%';
        heart.style.top = '100%';
        heart.style.fontSize = (Math.random() * 20 + 10) + 'px';
        heart.style.color = colors[Math.floor(Math.random() * colors.length)];
        heart.style.opacity = Math.random() * 0.3 + 0.1;
        heart.style.transition = 'all 5s linear';
        heart.style.pointerEvents = 'none';

        bg.appendChild(heart);

        setTimeout(() => {
            heart.style.transform = `translateY(-${window.innerHeight + 100}px) rotate(${Math.random() * 360}deg)`;
        }, 50);

        setTimeout(() => {
            heart.remove();
        }, 5050);
    }, 300);
}

// Keyboard navigation
document.addEventListener('keydown', (e) => {
    const modal = document.getElementById('imageModal');
    if (!modal.classList.contains('active')) return;

    if (e.key === 'ArrowLeft') navigateModal(-1);
    if (e.key === 'ArrowRight') navigateModal(1);
    if (e.key === 'Escape') closeImageModal();
});

// Close when clicking outside
document.addEventListener('DOMContentLoaded', () => {
    // Prevent browser from restoring scroll position automatically
    if (history.scrollRestoration) {
        history.scrollRestoration = 'manual';
    }

    // Robustly clear hash and scroll to top
    if (window.location.hash) {
        window.scrollTo(0, 0);
        history.replaceState("", document.title, window.location.pathname + window.location.search);
    }

    createValentineBackground();
    populateGallery();

    const modal = document.getElementById('imageModal');
    if (modal) {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeImageModal();
            }
        });
    }

    // Hide loading screen function
    function hideLoadingScreen() {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen && !loadingScreen.classList.contains('loaded')) {
            loadingScreen.classList.add('loaded');
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }
    }

    // Set maximum timeout to force hide after 3 seconds
    const maxTimeout = setTimeout(() => {
        hideLoadingScreen();
    }, 3000);

    // Wait for all fonts and critical images to load
    Promise.all([
        document.fonts.ready,
        // Only wait for logo, not all images (gallery is lazy-loaded)
        new Promise(resolve => {
            const logo = document.querySelector('.logo-svg');
            if (logo && logo.complete) {
                resolve();
            } else if (logo) {
                logo.addEventListener('load', resolve);
                logo.addEventListener('error', resolve);
            } else {
                resolve();
            }
        })
    ]).then(() => {
        clearTimeout(maxTimeout);
        hideLoadingScreen();
    }).catch(() => {
        clearTimeout(maxTimeout);
        hideLoadingScreen();
    });
});